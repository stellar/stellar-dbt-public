version: 2

models:
  - name: contract_details_hist
    description: "This table stores historical contract details with slowly changing dimension type 2 logic. It includes contract metadata and ledger information."
    columns:
      - name: contract_id
        description: "Unique identifier for the contract."
        tests:
          - not_null
      - name: ledger_key_hash
        description: "Hash of the ledger key related to the contract."
        tests:
          - not_null
      - name: start_date
        description: "Start date of the contract's current or historical record."
        tests:
          - not_null
      - name: end_date
        description: "End date of the contract's historical record."
      - name: is_current
        description: "Indicates whether the record is the current version."
        tests:
          - not_null
      - name: contract_key_type
        description: "Type of contract key."
      - name: contract_durability
        description: "Durability level of the contract."
      - name: contract_create_ts
        description: "Timestamp when the contract was created."
      - name: contract_update_ts
        description: "Timestamp when the contract was last updated."
      - name: contract_delete_ts
        description: "Timestamp when the contract was deleted."
      - name: last_modified_ledger
        description: "Ledger sequence at the last modification."
      - name: ledger_entry_change
        description: "Change in the ledger entry."
      - name: ledger_entry_change_type
        description: "Type of change in the ledger entry."
      - name: ledger_sequence
        description: "Sequence number of the ledger."
      - name: asset_code
        description: "Code of the asset related to the contract."
      - name: asset_issuer
        description: "Issuer of the asset related to the contract."
      - name: asset_type
        description: "Type of asset related to the contract."
      - name: balance
        description: "Balance of the contract."
      - name: balance_holder
        description: "Holder of the contract balance."
      - name: deleted
        description: "Indicates whether the contract has been deleted."
      - name: closed_at
        description: "Timestamp when the contract was closed."
        tests:
          - not_null
      - name: live_until_ledger_seq
        description: "Ledger sequence up to which the contract is live."
      - name: is_expired
        description: "Indicates whether the contract has expired."
      - name: n_instructions
        description: "Number of instructions executed in the contract."
      - name: n_functions
        description: "Number of functions executed in the contract."
      - name: n_globals
        description: "Number of global variables in the contract."
      - name: n_table_entries
        description: "Number of table entries in the contract."
      - name: n_types
        description: "Number of types in the contract."
      - name: n_data_segments
        description: "Number of data segments in the contract."
      - name: n_elem_segments
        description: "Number of element segments in the contract."
      - name: n_imports
        description: "Number of imports in the contract."
      - name: n_exports
        description: "Number of exports in the contract."
      - name: n_data_segment_bytes
        description: "Number of data segment bytes in the contract."
      - name: airflow_start_ts
        description: "Timestamp for when the Airflow job started."
        tests:
          - not_null
      - name: batch_id
        description: "Unique identifier for the batch run."
        tests:
          - not_null
      - name: batch_run_date
        description: "Date of the batch run."
        tests:
          - not_null
      - name: dw_load_ts
        description: "Timestamp when the data was loaded into the data warehouse."
        tests:
          - not_null
      - name: dw_update_ts
        description: "Timestamp when the data was last updated in the data warehouse."
        tests:
          - not_null

# Unique Combination Test
tests:
  - unique_combination_of_columns:
      name: contract_details_hist_unique_constraint
      columns:
        - ledger_key_hash
        - start_date
      description: "Test to ensure that each combination of ledger_key_hash and start_date is unique."
